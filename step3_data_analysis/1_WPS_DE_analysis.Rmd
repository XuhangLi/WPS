---
title: "WPS DE analysis"
author: "Xuhang Li"
date: "2024-01-13"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## WPS data sample Quality Control (QC)

Following the RNAi identity QC, we should already corrected all wrong clones and ready to move to the second QC step, sample qualities. Sample quality QC identifies bad samples that behave unexpected using Exploratory Data Analysis (EDA). For instance, a sample that decorrelates with the other two biological replicates for the same RNAi condition. This EDA based QC is a standard step of RNA-seq analysis and we follow the most common way - using PCA, correlation and distances. This walkthrough provides a convenient template to generate these QC plots for identifying bad samples.

Both standard and custom application of WPS should go through this sample quality check, and remove all bad samples before proceeding to the biological interpretation phase (such as a DE analysis).

### Required packages

```{r, results = 'hide', message = FALSE, warning = FALSE}
# install if not in your environment
library(stringr)
library(ggplot2)
library("GGally") 
library(DESeq2)
library(ggrepel)
library(pheatmap)
library(grid)
library("RColorBrewer")
library(png)
```

### Running QC

The following code uses a wrapper function to generate EDA plots for each condition. Please note that we offer this function just for the convenience to seamlessly analyze WPS data. Please feel free to perform the EDA/sample quality check in your own way!

```{r fig.show='hide', message=FALSE, results='hide'}
source('RNAi_QC_functions.R')

# we use met7 as an example
exps = c('met7')
libs = c('lib1','lib2','lib3','lib4','lib5','lib6')
# specify the ID (name in the treatment covariate) for control samples
controlID = 'x.vector' # in WPS, we conveniently call them 'vector'. If you use another name such as "control", change it to the actual name. 
# loop through each plate and then each library 
for (expID in exps){
  for (libID in libs){
    EDA_plots(expID,libID, controlID)
  }
}
```